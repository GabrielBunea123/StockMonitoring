{"version":3,"file":"index.dev.mjs","sources":["../../src/index.tsx"],"sourcesContent":["/* eslint-disable no-return-assign */\n/* eslint-disable no-underscore-dangle */\nimport * as React from 'react'\nimport {\n  ResizeObserver as Polyfill,\n  ResizeObserverEntry,\n} from '@juggle/resize-observer'\nimport useLayoutEffect from '@react-hook/passive-layout-effect'\nimport useLatest from '@react-hook/latest'\nimport rafSchd from 'raf-schd'\n\nconst ResizeObserver =\n  typeof window !== 'undefined' && 'ResizeObserver' in window\n    ? // @ts-ignore\n      window.ResizeObserver\n    : Polyfill\n\n/**\n * A React hook that fires a callback whenever ResizeObserver detects a change to its size\n *\n * @param target A React ref created by `useRef()` or an HTML element\n * @param callback Invoked with a single `ResizeObserverEntry` any time\n *   the `target` resizes\n */\nfunction useResizeObserver<T extends HTMLElement>(\n  target: React.RefObject<T> | T | null,\n  callback: UseResizeObserverCallback\n): Polyfill {\n  const resizeObserver = getResizeObserver()\n  const storedCallback = useLatest(callback)\n\n  useLayoutEffect(() => {\n    let didUnsubscribe = false\n    const targetEl = target && 'current' in target ? target.current : target\n    if (!targetEl) return () => {}\n\n    function cb(entry: ResizeObserverEntry, observer: Polyfill) {\n      if (didUnsubscribe) return\n      storedCallback.current(entry, observer)\n    }\n\n    resizeObserver.subscribe(targetEl as HTMLElement, cb)\n\n    return () => {\n      didUnsubscribe = true\n      resizeObserver.unsubscribe(targetEl as HTMLElement, cb)\n    }\n  }, [target, resizeObserver, storedCallback])\n\n  return resizeObserver.observer\n}\n\nfunction createResizeObserver() {\n  const callbacks: Map<any, Array<UseResizeObserverCallback>> = new Map()\n  const observer = new ResizeObserver(\n    rafSchd((entries, obs) => {\n      for (let i = 0; i < entries.length; i++) {\n        const cbs = callbacks.get(entries[i].target)\n        cbs?.forEach((cb) => cb(entries[i], obs))\n      }\n    })\n  )\n\n  return {\n    observer,\n    subscribe(target: HTMLElement, callback: UseResizeObserverCallback) {\n      observer.observe(target)\n      const cbs = callbacks.get(target) ?? []\n      cbs.push(callback)\n      callbacks.set(target, cbs)\n    },\n    unsubscribe(target: HTMLElement, callback: UseResizeObserverCallback) {\n      const cbs = callbacks.get(target) ?? []\n      if (cbs.length === 1) {\n        observer.unobserve(target)\n        callbacks.delete(target)\n        return\n      }\n      const cbIndex = cbs.indexOf(callback)\n      if (cbIndex !== -1) cbs.splice(cbIndex, 1)\n      callbacks.set(target, cbs)\n    },\n  }\n}\n\nlet _resizeObserver: ReturnType<typeof createResizeObserver>\n\nconst getResizeObserver = () =>\n  !_resizeObserver\n    ? (_resizeObserver = createResizeObserver())\n    : _resizeObserver\n\nexport type UseResizeObserverCallback = (\n  entry: ResizeObserverEntry,\n  observer: Polyfill\n) => any\n\nexport default useResizeObserver\n"],"names":["ResizeObserver","window","Polyfill","useResizeObserver","target","callback","resizeObserver","getResizeObserver","storedCallback","useLatest","useLayoutEffect","didUnsubscribe","targetEl","current","cb","entry","observer","subscribe","unsubscribe","createResizeObserver","callbacks","Map","rafSchd","entries","obs","i","cbs","get","forEach","length","observe","push","set","unobserve","delete","cbIndex","indexOf","splice","_resizeObserver"],"mappings":"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"}