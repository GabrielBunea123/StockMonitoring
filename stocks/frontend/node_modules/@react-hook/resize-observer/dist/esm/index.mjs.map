{"version":3,"file":"index.mjs","sources":["../../src/index.tsx"],"sourcesContent":["/* eslint-disable no-return-assign */\n/* eslint-disable no-underscore-dangle */\nimport * as React from 'react'\nimport {\n  ResizeObserver as Polyfill,\n  ResizeObserverEntry,\n} from '@juggle/resize-observer'\nimport useLayoutEffect from '@react-hook/passive-layout-effect'\nimport useLatest from '@react-hook/latest'\nimport rafSchd from 'raf-schd'\n\nconst ResizeObserver =\n  typeof window !== 'undefined' && 'ResizeObserver' in window\n    ? // @ts-ignore\n      window.ResizeObserver\n    : Polyfill\n\n/**\n * A React hook that fires a callback whenever ResizeObserver detects a change to its size\n *\n * @param target A React ref created by `useRef()` or an HTML element\n * @param callback Invoked with a single `ResizeObserverEntry` any time\n *   the `target` resizes\n */\nfunction useResizeObserver<T extends HTMLElement>(\n  target: React.RefObject<T> | T | null,\n  callback: UseResizeObserverCallback\n): Polyfill {\n  const resizeObserver = getResizeObserver()\n  const storedCallback = useLatest(callback)\n\n  useLayoutEffect(() => {\n    let didUnsubscribe = false\n    const targetEl = target && 'current' in target ? target.current : target\n    if (!targetEl) return () => {}\n\n    function cb(entry: ResizeObserverEntry, observer: Polyfill) {\n      if (didUnsubscribe) return\n      storedCallback.current(entry, observer)\n    }\n\n    resizeObserver.subscribe(targetEl as HTMLElement, cb)\n\n    return () => {\n      didUnsubscribe = true\n      resizeObserver.unsubscribe(targetEl as HTMLElement, cb)\n    }\n  }, [target, resizeObserver, storedCallback])\n\n  return resizeObserver.observer\n}\n\nfunction createResizeObserver() {\n  const callbacks: Map<any, Array<UseResizeObserverCallback>> = new Map()\n  const observer = new ResizeObserver(\n    rafSchd((entries, obs) => {\n      for (let i = 0; i < entries.length; i++) {\n        const cbs = callbacks.get(entries[i].target)\n        cbs?.forEach((cb) => cb(entries[i], obs))\n      }\n    })\n  )\n\n  return {\n    observer,\n    subscribe(target: HTMLElement, callback: UseResizeObserverCallback) {\n      observer.observe(target)\n      const cbs = callbacks.get(target) ?? []\n      cbs.push(callback)\n      callbacks.set(target, cbs)\n    },\n    unsubscribe(target: HTMLElement, callback: UseResizeObserverCallback) {\n      const cbs = callbacks.get(target) ?? []\n      if (cbs.length === 1) {\n        observer.unobserve(target)\n        callbacks.delete(target)\n        return\n      }\n      const cbIndex = cbs.indexOf(callback)\n      if (cbIndex !== -1) cbs.splice(cbIndex, 1)\n      callbacks.set(target, cbs)\n    },\n  }\n}\n\nlet _resizeObserver: ReturnType<typeof createResizeObserver>\n\nconst getResizeObserver = () =>\n  !_resizeObserver\n    ? (_resizeObserver = createResizeObserver())\n    : _resizeObserver\n\nexport type UseResizeObserverCallback = (\n  entry: ResizeObserverEntry,\n  observer: Polyfill\n) => any\n\nexport default useResizeObserver\n"],"names":["_resizeObserver","ResizeObserver","window","Polyfill","target","callback","callbacks","observer","resizeObserver","Map","rafSchd","entries","obs","i","cbs","get","forEach","cb","length","subscribe","observe","push","set","unsubscribe","unobserve","delete","cbIndex","indexOf","splice","storedCallback","useLatest","useLayoutEffect","entry","didUnsubscribe","current","targetEl"],"mappings":"AAkC0B,kLAvB1B,IA0EIA,EA1EEC,EACc,oBAAXC,QAA0B,mBAAoBA,OAEjDA,OAAOD,eACPE,iBASN,SACEC,EACAC,OA2BMC,EACAC,EA1BAC,EA4DLR,IAnCKM,EAAwD,IAAIG,IAC5DF,EAAW,IAAIN,EACnBS,EAAQ,CAACC,EAASC,wBACPC,OACDC,EAAMR,EAAUS,IAAIJ,EAAQE,GAAGT,QACrCU,MAAAA,GAAAA,EAAKE,QAASC,GAAOA,EAAGN,EAAQE,GAAID,KAF7BC,EAAI,EAAGA,EAAIF,EAAQO,OAAQL,MAA3BA,MAiCRb,EA1BE,CACLO,SAAAA,EACAY,UAAUf,EAAqBC,SAC7BE,EAASa,QAAQhB,OACXU,YAAMR,EAAUS,IAAIX,kBAAW,GACrCU,EAAIO,KAAKhB,GACTC,EAAUgB,IAAIlB,EAAQU,IAExBS,YAAYnB,EAAqBC,SACzBS,YAAMR,EAAUS,IAAIX,kBAAW,MAClB,IAAfU,EAAII,cACNX,EAASiB,UAAUpB,QACnBE,EAAUmB,OAAOrB,OAGbsB,EAAUZ,EAAIa,QAAQtB,IACX,IAAbqB,GAAgBZ,EAAIc,OAAOF,EAAS,GACxCpB,EAAUgB,IAAIlB,EAAQU,MAnDpBe,EAAiBC,EAAUzB,UAEjC0B,EAAgB,cAKLd,EAAGe,EAA4BzB,GAClC0B,GACJJ,EAAeK,QAAQF,EAAOzB,OAN5B0B,EAAiB,EACfE,EAAW/B,GAAU,YAAaA,EAASA,EAAO8B,QAAU9B,SAC7D+B,GAOL3B,EAAeW,UAAUgB,EAAyBlB,GAE3C,KACLgB,EAAiB,EACjBzB,EAAee,YAAYY,EAAyBlB,QAErD,CAACb,EAAQI,EAAgBqB,IAErBrB,EAAeD"}